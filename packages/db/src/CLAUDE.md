# Database Package

## OVERVIEW

Drizzle ORM with PostgreSQL, auto-generated auth tables via Better-Auth adapter.

**Status:** All schemas defined and migrations implemented (Phase 1-6 complete).

## STRUCTURE

```
src/
├── index.ts              # DB client export
├── schema/               # Table definitions
│   └── *.ts              # Schema files
└── migrations/           # Migration tracking
    └── meta/             # Migration metadata
```

## WHERE TO LOOK

| Task          | Location                                       |
| ------------- | ---------------------------------------------- |
| DB client     | index.ts                                       |
| Table schemas | schema/\*.ts                                   |
| Auth tables   | Auto-generated by Better-Auth                  |
| Relations     | Define in schema files using Drizzle relations |

## CONVENTIONS

### Schema Definition

Use `pgTable` for PostgreSQL tables, define relations for type-safe queries.

- `id` use `uuidv7()` for unique IDs (Except auto-generated by Better-Auth: `auth.ts`)
- `createdAt` and `updatedAt` in all tables
- example:

```typescript
import { pgTable, serial, text } from "drizzle-orm/pg-core";
import { relations } from "drizzle-orm";

export const users = pgTable("users", {
  id: uuid('id').primaryKey().default(sql`uuidv7()`),
  name: text("name").notNull(),
  createdAt: timestamp("created_at").defaultNow().notNull(),
 updatedAt: timestamp("updated_at")
  .defaultNow()
  .$onUpdate(() => new Date())
  .notNull(),
});

export const usersRelations = relations(users, ({ many }) => ({
  posts: many(posts),
}));
```

### Migrations

Apply schema changes via push (tracks in git):

```bash
bun run db:push         # Apply schema, update types
bun run db:studio       # GUI at http://localhost:5555
bun run db:generate     # Generate types from SQL
bun run db:migrate      # Create migration file
```

### Auth Tables

All auth-related tables (session, user, etc.) are auto-generated by Better-Auth - don't modify manually.

## ANTI-PATTERNS

- **Don't modify auto-generated auth tables** - Better-Auth manages these
- **Don't commit generated files** - push schema changes, not generated SQL
- **Don't skip relations** - always define relations for type-safe queries
- **Don't use raw SQL** - use Drizzle query builder for type safety

## UNIQUE STYLES

- **Push-based migrations**: `db:push` updates schema and types, no manual SQL
- **Auth integration**: Better-Auth adapter auto-generates auth tables in Drizzle schema
- **Type-safe relations**: Drizzle relations provide full type safety for joins

## NOTES

- Auth tables live in schema but are generated - don't edit
- Use `bun run db:studio` for visual database inspection
- Schema changes should be committed, generated migrations tracked
